@page "/hippo-page/{id:int}"
@using Data
@using Data.Classes
@using Models
@using Repository
@rendermode InteractiveServer
@inject ProductRepository productRepository
@inject ShoppingCart shoppingCart

<p>Products left: @hippo.Quantity</p>
<img src="@(soldOut ? hippo.ImgUrlSoldOut : hippo.ImgUrl)" />
<h3>@hippo?.Title</h3>
<p>Description: @hippo?.Description</p>
<p>Price: @hippo?.Price (USD)</p>
<button @onclick="() => AddToCart(hippo)" class="btn btn-primary">Add to cart</button>


@code {
    [Parameter]
    public int Id { get; set; }

    public Product? hippo = new();
    bool soldOut = false; 

    protected override async Task OnInitializedAsync()
    {
        hippo = await productRepository.GetProduct(Id);
        if (hippo.Quantity < 1)
            soldOut = true;
    }

    public async Task AddToCart(Product addedHippo)
    {
        // shoppingCart.AddToOrder(addedHippo);
        shoppingCart.AddToProductsAndAmounts(addedHippo);
        await productRepository.UpdateQuantity(addedHippo.Id);
        if (addedHippo.Quantity < 1)
            soldOut = true;
    }
}
